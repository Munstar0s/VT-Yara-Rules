import "vt"

rule ActiveExploitedCVEs{
meta:
  description = "Files weaponizing certain CVEs with proof of active exploitation, this rule looks into specific file types rather than using the shotgun approach"
  author = "Dari Ghazi - Asocthreatintel.es@capgemini.com"
  target_entity = "file"
  version = "1.0"
  creation_date = "01-06-2023"
  first_imported = "01-06-2023"
  last_modified = "08-28-2023"
  status = "RELEASED"
  sharing = "TLP:WHITE"

condition:
  for any tag in vt.metadata.tags : 
    (tag == "CVE-2023-32315" or 
     tag == "CVE-2023-38831" or 
     tag == "CVE-2023-27532" or 
     tag == "CVE-2023-26359" or 
     tag == "CVE-2023-38035" or 
     tag == "CVE-2023-40711" or 
     tag == "CVE-2023-24489" or 
     tag == "CVE-2023-36884" or 
     tag == "CVE-2023-38180" or 
     tag == "CVE-2023-35081" or 
     tag == "CVE-2023-37580" or 
     tag =="CVE-2023-29298" or 
     tag =="CVE-2023-38205" or 
     tag == "CVE-2023-34192" or 
     tag == "CVE-2023-3519" or 
     tag == "CVE-2023-28121" or 
     tag == "CVE-2023-38198" or 
     tag == "CVE-2023-41080" or 
     tag == "CVE-2023-21939" or 
     tag == "CVE-2023-38388" or 
     tag == "CVE-2022-48560" or 
     tag == "CVE-2022-48065" or 
     tag == "CVE-2022-48064" or 
     tag == "CVE-2023-3823" or 
     tag == "CVE-2023-27997" or 
     tag == "CVE-2023-34362") and 
    (vt.metadata.file_type == vt.FileType.EMAIL or
    vt.metadata.file_type == vt.FileType.OUTLOOK or
    vt.metadata.file_type == vt.FileType.CAB or
    vt.metadata.file_type == vt.FileType.BZIP or
    vt.metadata.file_type == vt.FileType.DOC or
    vt.metadata.file_type == vt.FileType.DOCX or
    vt.metadata.file_type == vt.FileType.DOS_COM or
    vt.metadata.file_type == vt.FileType.PDF or
    vt.metadata.file_type == vt.FileType.PE_DLL or
    vt.metadata.file_type == vt.FileType.PE_EXE or
    vt.metadata.file_type == vt.FileType.PPT or
    vt.metadata.file_type == vt.FileType.PPTX or
    vt.metadata.file_type == vt.FileType.PHP or
    vt.metadata.file_type == vt.FileType.XLS or
    vt.metadata.file_type == vt.FileType.XLSX or
    vt.metadata.file_type == vt.FileType.CHM or
    vt.metadata.file_type == vt.FileType.DOS_EXE or
    vt.metadata.file_type == vt.FileType.ELF or
    vt.metadata.file_type == vt.FileType.GZIP or
    vt.metadata.file_type == vt.FileType.JAR or
    vt.metadata.file_type == vt.FileType.JAVASCRIPT or
    vt.metadata.file_type == vt.FileType.LNK or
    vt.metadata.file_type == vt.FileType.MSI or
    vt.metadata.file_type == vt.FileType.PKG or
    vt.metadata.file_type == vt.FileType.PS or
    vt.metadata.file_type == vt.FileType.RAR or
    vt.metadata.file_type == vt.FileType.RPM or
    vt.metadata.file_type == vt.FileType.SEVENZIP or
    vt.metadata.file_type == vt.FileType.TAR or
    vt.metadata.file_type == vt.FileType.TIFF or
    vt.metadata.file_type == vt.FileType.TTF or
    vt.metadata.file_type == vt.FileType.RTF or
    vt.metadata.file_type == vt.FileType.DEB or
    vt.metadata.file_type == vt.FileType.ICO or
    vt.metadata.file_type == vt.FileType.HTML) and 
    vt.metadata.analysis_stats.malicious >= 5
}
